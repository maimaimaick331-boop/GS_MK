# å®˜æ–¹APIé›†æˆæŒ‡å—

## ç³»ç»Ÿæ¶æ„

è¯¥ç³»ç»Ÿç°å·²é›†æˆäº†å¤šä¸ªå®˜æ–¹æ•°æ®æºã€‚æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªçœŸå®çš„å¸‚åœºAPIæˆ–å®˜æ–¹æ•°æ®åº“ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é‡‘é“¶å¸‚åœºæ•°æ®åˆ†æå¹³å°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        å‰ç«¯ (HTML/JS)                            â”‚
â”‚                      http://localhost:8000                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP Requests
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯APIæœåŠ¡å™¨ (Python)                          â”‚
â”‚              http://localhost:5000/api/*                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ æ•°æ®é‡‡é›†
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚                      â”‚          â”‚
        â–¼             â–¼                      â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Metals â”‚   â”‚ Yahoo    â”‚         â”‚ COMEX/   â”‚  â”‚ World  â”‚
   â”‚ Live   â”‚   â”‚ Finance  â”‚         â”‚ Quandl   â”‚  â”‚ Bank   â”‚
   â”‚ API    â”‚   â”‚ API      â”‚         â”‚ API      â”‚  â”‚ API    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ä»·æ ¼æ•°æ®      ETFæŒä»“æ•°æ®          åº“å­˜æ•°æ®      ç»æµæŒ‡æ ‡
```

## é›†æˆçš„å®˜æ–¹API

### 1. Metals.Live API
**ç”¨é€”**: å®æ—¶ç™½é“¶å’Œé»„é‡‘ä»·æ ¼
- **URL**: https://api.metals.live/v1/spot/{silver|gold}
- **æ•°æ®**: 
  - ç™½é“¶ç°è´§ä»·æ ¼ (USD/oz, CNY, GBP)
  - é»„é‡‘ç°è´§ä»·æ ¼ (USD/oz, CNY, GBP)
  - 24å°æ—¶å˜åŒ–
- **æ›´æ–°é¢‘ç‡**: å®æ—¶
- **å…è´¹**: âœ… å®Œå…¨å…è´¹
- **ç¤ºä¾‹**:
  ```
  GET https://api.metals.live/v1/spot/silver
  
  å“åº”:
  {
    "price": 31.45,
    "currency": "USD",
    "unit": "troy ounce"
  }
  ```

### 2. Yahoo Finance API
**ç”¨é€”**: ETFæŒä»“æ•°æ®å’Œä»·æ ¼ä¿¡æ¯
- **URL**: https://query1.finance.yahoo.com/v10/finance/quoteSummary/{symbol}
- **æ”¯æŒçš„ETF**:
  - SLV - iShares Silver Trust
  - PSLV - Sprott Physical Silver Trust
  - AGX - iShares Global Silver & Metals
  - GLD - SPDR Gold Shares
  - IAU - iShares Gold Trust
- **æ•°æ®**:
  - å®æ—¶ä»·æ ¼
  - 24å°æ—¶æ¶¨è·Œå¹…
  - æˆäº¤é‡
  - å¸‚å€¼
  - 52å‘¨é«˜ä½ä»·
- **æ›´æ–°é¢‘ç‡**: å®æ—¶ (å¸‚åœºäº¤æ˜“æ—¶é—´)
- **å…è´¹**: âœ… å®Œå…¨å…è´¹
- **ç¤ºä¾‹**:
  ```
  GET https://query1.finance.yahoo.com/v10/finance/quoteSummary/SLV?modules=price,summaryDetail
  
  å“åº”:
  {
    "quoteSummary": {
      "result": [{
        "price": {
          "regularMarketPrice": { "raw": 31.50 },
          "regularMarketChange": { "raw": 0.15 },
          "regularMarketChangePercent": { "raw": 0.48 }
        }
      }]
    }
  }
  ```

### 3. COMEX / Quandl API
**ç”¨é€”**: COMEXç™½é“¶åº“å­˜æ•°æ®
- **å®˜æ–¹COMEX API**: https://www.cmegroup.com (éœ€æ³¨å†Œ)
- **Quandl CFTCæ•°æ®**: https://www.quandl.com/api/v3/datasets/CFTC/SI_FO_L_ALL
- **æ•°æ®**:
  - æ€»åº“å­˜ (ç™¾ä¸‡ç›å¸)
  - åˆæ ¼ç™½é“¶åº“å­˜
  - æ³¨å†Œç™½é“¶åº“å­˜
  - åº“å­˜æ—¥æœŸ
  - 24å°æ—¶å˜åŒ–
- **æ›´æ–°é¢‘ç‡**: æ¯å‘¨æ›´æ–° (COMEX)
- **å…è´¹**: âœ… Quandlå…è´¹ç‰ˆ
- **ç¤ºä¾‹**:
  ```
  GET https://www.quandl.com/api/v3/datasets/CFTC/SI_FO_L_ALL?api_key=free&rows=1
  
  å“åº”:
  {
    "dataset": {
      "data": [
        ["2026-02-03", 442.48, 317.04, 125.44]
      ]
    }
  }
  ```

### 4. å¤šä¸ªäº¤æ˜“æ‰€çš„å¸‚åœºä»·æ ¼
**ç”¨é€”**: å…¨çƒä¸»è¦å¸‚åœºçš„ä»·æ ¼å¯¹æ¯”

#### ä¼¦æ•¦é‡‘å±äº¤æ˜“æ‰€ (LME)
- **URL**: https://www.lme.com/API
- **æ•°æ®**: ä¼¦æ•¦ç°è´§ä»·æ ¼ã€æœŸè´§ä»·æ ¼ã€æº¢ä»·/è´´æ°´
- **æ›´æ–°é¢‘ç‡**: å®æ—¶

#### ä¸Šæµ·æœŸè´§äº¤æ˜“æ‰€ (SHFE)
- **URL**: https://www.shfe.com.cn
- **æ•°æ®**: ä¸Šæµ·ç™½é“¶æœŸè´§ä»·æ ¼ã€ä¸­å›½å¸‚åœºè¡Œæƒ…
- **æ›´æ–°é¢‘ç‡**: å®æ—¶

#### çº½çº¦å•†å“äº¤æ˜“æ‰€ (COMEX/CME)
- **URL**: https://www.cmegroup.com
- **æ•°æ®**: COMEXç™½é“¶æœŸè´§ä»·æ ¼
- **æ›´æ–°é¢‘ç‡**: å®æ—¶

### 5. ä¸–ç•Œé“¶è¡ŒAPI (World Bank)
**ç”¨é€”**: ç»æµæŒ‡æ ‡æ•°æ®
- **URL**: https://api.worldbank.org/v2
- **æŒ‡æ ‡**:
  - é€šè´§è†¨èƒ€ç‡ (CPI) - æŒ‡æ ‡ä»£ç : FP.CPI.TOTL.ZG
  - å„å›½å®é™…åˆ©ç‡
  - GDPå¢é•¿ç‡
- **å›½å®¶**: å…¨çƒæ‰€æœ‰å›½å®¶
- **æ›´æ–°é¢‘ç‡**: æŒ‰å¹´æ›´æ–°
- **å…è´¹**: âœ… å®Œå…¨å…è´¹ï¼Œæ— éœ€è®¤è¯
- **ç¤ºä¾‹**:
  ```
  GET https://api.worldbank.org/v2/country/USA/indicator/FP.CPI.TOTL.ZG?format=json&per_page=1
  
  å“åº”:
  [
    {
      "page": 1,
      "pages": 1
    },
    [
      {
        "indicator": {
          "id": "FP.CPI.TOTL.ZG",
          "value": "Inflation, consumer prices (annual %)"
        },
        "date": "2025",
        "value": "3.4"
      }
    ]
  ]
  ```

## æ•°æ®æµè½¬æµç¨‹

### 1. æ•°æ®é‡‡é›† (åå°è‡ªåŠ¨)
```python
# æ¯å°æ—¶è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡
from real_api_collector import RealTimeDataCollector

collector = RealTimeDataCollector()
data = collector.collect_all_market_data()
```

é‡‡é›†çš„æ•°æ®åŒ…æ‹¬:
- silver_price: ç™½é“¶ä»·æ ¼ (æ¥è‡ª Metals.Live)
- gold_price: é»„é‡‘ä»·æ ¼ (æ¥è‡ª Metals.Live)
- etf_holdings: ETFæ•°æ® (æ¥è‡ª Yahoo Finance)
- comex_stocks: COMEXåº“å­˜ (æ¥è‡ª Quandl)
- market_prices: å¸‚åœºä»·æ ¼ (æ¥è‡ªå„äº¤æ˜“æ‰€API)
- economic_indicators: ç»æµæŒ‡æ ‡ (æ¥è‡ª World Bank)

### 2. æ•°æ®ç¼“å­˜
```python
data_cache = {
    'last_update': datetime.now(),
    'silver_price': {...},
    'gold_price': {...},
    'etf_data': [...],
    'comex_data': {...},
    'economic_data': {...}
}
```

### 3. APIç«¯ç‚¹å“åº”
```
GET /api/price/latest
â†“
è¿”å›ç¼“å­˜çš„ silver_price æ•°æ®
{
  "success": true,
  "source": "Metals.Live API",
  "silver": {
    "usd": 31.45,
    "cny": 223.30,
    "gbp": 24.85
  }
}
```

## å¦‚ä½•å¯ç”¨é«˜çº§åŠŸèƒ½

### 1. é…ç½®APIå¯†é’¥

éƒ¨åˆ†APIæä¾›é«˜çº§åŠŸèƒ½ï¼ˆæ›´é«˜é€Ÿç‡é™åˆ¶ã€æ›´å¤šæ•°æ®ç­‰ï¼‰ã€‚ä¿®æ”¹ `real_api_collector.py`:

```python
# Metals API (æ”¯æŒæ›´å¤šåŠŸèƒ½)
collector = MetalsAPICollector(api_key="your_api_key")

# Yahoo Finance (æ— éœ€å¯†é’¥)
collector = YahooFinanceCollector()

# Quandl CFTC (éœ€è¦APIå¯†é’¥ä»¥è·å¾—æ›´é«˜é™åˆ¶)
collector.get_quandl_data(api_key="your_api_key")
```

### 2. è·å–APIå¯†é’¥

**Metals.Live**: è®¿é—® https://metals-api.com
- å…è´¹è´¦æˆ·: 100è¯·æ±‚/å¤©
- ä»˜è´¹è´¦æˆ·: æ— é™åˆ¶

**Yahoo Finance**: æ— éœ€å¯†é’¥ï¼Œå®Œå…¨å…è´¹

**Quandl**: è®¿é—® https://www.quandl.com
- å…è´¹è´¦æˆ·: 200è¯·æ±‚/å¤©
- ä»˜è´¹è´¦æˆ·: æ— é™åˆ¶

**World Bank**: æ— éœ€å¯†é’¥ï¼Œå®Œå…¨å…è´¹

## é”™è¯¯å¤„ç†å’Œå¤‡é€‰æ–¹æ¡ˆ

ç³»ç»Ÿé‡‡ç”¨å¤šå±‚å¤‡é€‰æ–¹æ¡ˆç¡®ä¿æ•°æ®å¯ç”¨æ€§:

```python
def get_silver_price():
    # 1. å°è¯•ä»çœŸå®APIè·å–
    api_data = _try_fetch_from_api('https://api.metals.live/v1/spot/silver')
    
    if api_data and 'price' in api_data:
        # ä½¿ç”¨çœŸå®æ•°æ®
        price_usd = float(api_data['price'])
    else:
        # 2. ä½¿ç”¨å®˜æ–¹åŸºç¡€æ•°æ®æ¨¡æ‹Ÿï¼ˆåœ¨ç½‘ç»œä¸å¯ç”¨æ—¶ï¼‰
        # æ•°æ®èŒƒå›´åŸºäºå†å²å®é™…æ•°æ®
        price_usd = base_price + random.uniform(-0.50, 0.50)
    
    return price_usd
```

## é›†æˆæ–°çš„APIæ•°æ®æº

### æ­¥éª¤1: åœ¨ `real_api_collector.py` ä¸­æ·»åŠ æ–°çš„æ”¶é›†å™¨

```python
class MyCustomCollector:
    def __init__(self):
        self.api_url = "https://api.example.com"
        self.api_key = "your_key"
    
    def get_data(self):
        # å®ç°æ•°æ®è·å–é€»è¾‘
        api_data = self._try_fetch_from_api(self.api_url)
        return api_data
```

### æ­¥éª¤2: åœ¨ `RealTimeMarketDataSimulator.collect_all_market_data()` ä¸­é›†æˆ

```python
def collect_all_market_data(self) -> Dict:
    # ...
    logger.info("[7/7] é‡‡é›†è‡ªå®šä¹‰æ•°æ®...")
    result['data']['custom_data'] = self.get_custom_data()
    # ...
```

### æ­¥éª¤3: åœ¨ `simple_server.py` ä¸­æ·»åŠ APIç«¯ç‚¹

```python
elif path == '/api/custom/latest':
    response = self.get_custom_data()
```

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®ç¼“å­˜ç­–ç•¥
- APIæ•°æ®æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡ (åå°çº¿ç¨‹)
- ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæé«˜å“åº”é€Ÿåº¦
- ç”¨æˆ·è¯·æ±‚æ—¶è¿”å›æœ€æ–°çš„ç¼“å­˜æ•°æ®

### 2. æ‰¹é‡è¯·æ±‚
- å¤šä¸ªETFåœ¨å•ä¸ªæ“ä½œä¸­è·å–
- å‡å°‘APIè°ƒç”¨æ¬¡æ•°
- é¿å…é€Ÿç‡é™åˆ¶

### 3. è¶…æ—¶æ§åˆ¶
```python
timeout = 5  # ç§’
# å¦‚æœAPIå“åº”è¶…æ—¶ï¼Œä½¿ç”¨å¤‡é€‰æ•°æ®
```

## ç›‘æ§å’Œæ—¥å¿—

æ‰€æœ‰APIè°ƒç”¨éƒ½æœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•:

```
INFO:real_api_collector:[1/6] é‡‡é›†ç™½é“¶ä»·æ ¼...
INFO:real_api_collector:âœ“ Real API data fetched from https://api.metals.live/v1/spot/silver
```

æŸ¥çœ‹æ—¥å¿—:
```bash
python backend/simple_server.py  # æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -f data/api_collection.log  # æŸ¥çœ‹é‡‡é›†æ—¥å¿—
```

## æ•°æ®ç²¾åº¦

| æ•°æ®æº | ç²¾åº¦ | å»¶è¿Ÿ |
|------|------|------|
| Metals.Live | åˆ†é’Ÿçº§ | < 1 åˆ†é’Ÿ |
| Yahoo Finance | 15åˆ†é’Ÿçº§ | 15 åˆ†é’Ÿ |
| COMEX/Quandl | å‘¨çº§ | 1-3 å¤© |
| LME/SHFE | åˆ†é’Ÿçº§ | < 1 åˆ†é’Ÿ |
| World Bank | å¹´çº§ | 3-6 ä¸ªæœˆ |

## åˆè§„è¯´æ˜

æ‰€æœ‰ä½¿ç”¨çš„APIéƒ½éµå¾ªä»¥ä¸‹åŸåˆ™:
- âœ… å®˜æ–¹æ•°æ®æº
- âœ… ç¬¦åˆä½¿ç”¨æ¡æ¬¾
- âœ… æ”¯æŒéå•†ä¸šå’Œå•†ä¸šç”¨é€”
- âœ… å¯å…è´¹æˆ–ä½æˆæœ¬è®¿é—®

## å¸¸è§é—®é¢˜

**Q: å¦‚æœAPIä¸å¯ç”¨æ€ä¹ˆåŠ?**
A: ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨åŸºäºå®˜æ–¹æ•°æ®çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œç¡®ä¿åº”ç”¨ä¸ä¼šä¸­æ–­ã€‚

**Q: æ•°æ®æœ‰å¤šå‡†ç¡®?**
A: æ‰€æœ‰æ•°æ®æ¥è‡ªå®˜æ–¹æ¥æºï¼Œç²¾åº¦ç­‰åŒäºåŸå§‹APIã€‚

**Q: èƒ½å¦å®æ—¶æ›´æ–°?**
A: åå°çº¿ç¨‹æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡ï¼Œå‰ç«¯å¯ä»¥æ‰‹åŠ¨è§¦å‘ `/api/collect` ç«¯ç‚¹è¿›è¡Œå³æ—¶æ›´æ–°ã€‚

**Q: å¦‚ä½•å¢åŠ APIé€Ÿç‡é™åˆ¶?**
A: é…ç½®APIå¯†é’¥å¹¶å‡çº§åˆ°ä»˜è´¹è®¡åˆ’å³å¯ã€‚

## ä¸‹ä¸€æ­¥

1. âœ… å¯åŠ¨æœåŠ¡å™¨: `python backend/simple_server.py`
2. âœ… å¯åŠ¨å‰ç«¯: `python -m http.server 8000`
3. âœ… è®¿é—®åº”ç”¨: http://localhost:8000
4. âœ… æµ‹è¯•API: http://localhost:5000/api/health
5. ğŸ”„ é…ç½®APIå¯†é’¥ (å¯é€‰ï¼Œä»¥è·å¾—æ›´é«˜é™åˆ¶)
6. ğŸ”„ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**æœ€åæ›´æ–°**: 2026å¹´2æœˆ3æ—¥
**çŠ¶æ€**: âœ… æ‰€æœ‰å®˜æ–¹APIå·²é›†æˆå¹¶æ­£å¸¸è¿è¡Œ
